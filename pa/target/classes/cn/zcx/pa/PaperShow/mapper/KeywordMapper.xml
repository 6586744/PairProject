<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.zcx.pa.PaperShow.dao.KeywordDao">
    <!--插入-->
    <insert id="insertKeyword" parameterType="cn.zcx.pa.PaperShow.pojo.Keyword">
        INSERT INTO keyword(id,kid,pid,keyword,conference,publicationYear)
        VALUES(null,#{kid},#{pid}#{keyword},#{conference},#{publicationYear})
    </insert>

    <!--根据id删除-->
    <delete id="deleteById" parameterType="string">
        DELETE FROM keyword WHERE kid=#{kid}
    </delete>

    <!--判断关键词是否存在-->
    <select id="isKeywordExist"  resultType="java.lang.Boolean">
        <![CDATA[ select count(kid) from keyword
        where keyword=#{keyword} AND conference=#{conference} AND publicationYear=#{publicationYear} ]]>
    </select>

    <!--通过对象更新-->
    <update id="updateByObject" parameterType="cn.zcx.pa.PaperShow.pojo.Keyword">
        UPDATE keyword SET keyword=#{keyword},conference=#{conference}
        WHERE kid=#{kid}
    </update>

<!--    &lt;!&ndash;查询频率前n位的keyword&ndash;&gt;-->
<!--    <select id="selectKeywordsOrderByCount" parameterType="int" resultMap="Keyword">-->
<!--        SELECT * FROM keyword ORDER BY `count` DESC LIMIT ${size}-->
<!--    </select>-->


    <!--通过map更新-->
    <update id="updateByMap" parameterType="map">
        UPDATE keyword
        <set>
            <if test="keyword !=NULL">keyword=#{keyword},</if>
            <if test="conference !=NULL">conference=#{conference}</if>
        </set>
        WHERE kid=#{kid}
    </update>

    <!--通过id查询-->
    <select id="selectKeywordById" parameterType="string" resultMap="Keyword">
        SELECT * FROM keyword WHERE pid=#{pid}
    </select>

    <!--通过map查询-->
    <select id="selectKeywordsByMap" parameterType="map" resultMap="Keyword">
        SELECT *
        FROM paper AS p
        LEFT JOIN keyword AS k ON p.pid=k.kid
        LEFT JOIN kp ON kp.pid=p.pid AND kp.kid=k.kid
        <where>
            <if test="keyword !=NULL">AND keyword=#{keyword}</if>
            <if test="conference !=NULL">AND conference=#{conference}</if>
        </where>
    </select>

    <!--Keyword的映射-->
    <resultMap id="Keyword" type="cn.zcx.pa.PaperShow.pojo.Keyword">
        <result column="kid" property="kid"/>
        <result column="keyword" property="keyword"/>
        <result column="conference" property="conference"/>
    </resultMap>
</mapper>